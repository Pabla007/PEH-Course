<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>PrintNightmare (CVE-2021-1675) Walkthrough</title>
</head><body>Github: <a href="https://github.com/cube0x0/CVE-2021-1675">https://github.com/cube0x0/CVE-2021-1675<br/>
</a><a href="https://github.com/cube0x0/CVE-2021-1675"><br/>
</a>Obfuscation: <a href="https://www.youtube.com/watch?v=g7JGpI6QzxA">https://www.youtube.com/watch?v=g7JGpI6QzxA</a><br/>
<br/>
<br/>
<br/>
Print NightMare was the biggest bugs to hit in 2021 cuz let's face it there are tons of things out there that never get patched.<br/>
<br/>
It requires no authentication really whatsoever outside of a user account (i.e. Post-Compromised Attack)<br/>
It takes advantage of the printer spooler and it's similar to <b><span style="background-color: #ffff00">Prince Spoof</span></b>.<br/>
<br/>
Check whether it's Vulnerable in our environment all we have to use is something called as RPC dump.<br/>
<b>rpcdump.py @&lt;Domain Controller IP address&gt; | egrep 'MS-RPRN|MS-PAR'</b><br/>
<br/>
Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol <br/>
Protocol: [MS-RPRN]: Print System Remote Protocol<br/>
<img height="256" src="printnight1.png" width="800"/><br/>
<br/>
But we need to get latest version of IMPACKET to run this code.<br/>
After that copy the code in the CVE-2021-1675.py through this link: https://raw.githubusercontent.com/cube0x0/CVE-2021-1675/main/CVE-2021-1675.py<br/>
using Nano/gedit.<br/>
<br/>
Things to set in order to run this attack:<br/>
1- Make a dll using MSFvenom and host that using SMB server in Impacket toolkit.<br/>
<img height="212" src="printnight2.png" width="800"/><br/>
<br/>
2- The other side of this coin is anytime we do MsfVenom we also have to do MSF console.<br/>
will set the Lhost and Lport as well as the payload and run the listner.<br/>
<img height="331" src="image.png" width="500"/><br/>
<br/>
<br/>
3- Set up the SMB server but it failed as through an <span style="background-color: #ff0000"><b>error</b></span>so have to run the command again using smb2support<br/>
<img height="265" src="printnight4.png" width="700"/><br/>
<br/>
as the during the attack it was not able to locate the file so that we have to change <b>pwd</b>to <b>root</b>.<br/>
<img height="437" src="printnight8.png" width="700"/><br/>
<br/>
<br/>
4- Will run the code finally:<br/>
<img height="266" src="printnight3.png" width="700"/><br/>
<br/>
<img height="291" src="printnight6.png" width="650"/><br/>
<br/>
We have to disable the antivirus in the Punisher machine as it got on everytime we turn on the PC.<br/>
<br/>
We didn't got in the hashes as the mentor did but did get the meterpreter shell luckily.<br/>
<img height="560" src="printnight7.png" width="750"/><br/>
<br/>
If you want to go one step further we can <b>obfuscate dll</b><br/>
</body></html>