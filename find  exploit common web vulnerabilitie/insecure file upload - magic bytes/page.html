<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Insecure File Upload - Magic Bytes</title>
</head><body>The logo.png got uploaded successfully<br/>
<img height="324" src="image.png" width="550"/><br/>
<br/>
<br/>
But when we were trying to uplaod .txt file got this error<br/>
<img height="348" src="image 2.png" width="700"/><br/>
<br/>
Will BurpSuite and see if the check are happening on the Client SIde or Serve Side<br/>
<img height="292" src="image 3.png" width="750"/><br/>
<br/>
From we are sure that the checks are happening at the <b><span style="background-color: #ffa300">Server Side</span></b>this time.<br/>
<br/>
&lt;?php system($_GET['cmd']; )?&gt;<br/>
NOw we have 2 thoughts here:<br/>
1st that we can't upload php file here<br/>
2nd is that how are you actually checking the files<br/>
<br/>
This trick works in old servers<br/>
logo2.php%00png<br/>
here %00 is called the null byte and this terminates so when the web server calls it<br/>
interprets this differently.<br/>
<br/>
<b>Null Byte</b>attacks are kind of an old but gold vulnerability.<br/>
And if an application is not configured correctly (i.e. htaccess file is configured incorectly so sometimes we can get execution like this cuz this will try and regex for the php withouut including the end of line here.)<br/>
<br/>
Another way is to upload a <b>special file</b>like an htaccess file, that allows us to execute files like asd as they were like php files.<br/>
<br/>
3rd thing to check is the <b>Magic Bytes</b>(i.e. Magic Bytes are the first few bytes of a file which tell the system what type of file it is)<br/>
<img height="348" src="image 4.png" width="650"/><br/>
<br/>
Here �PNG is the mmagic byte for png<br/>
▒<br/>
����lk�7�,ZtSoftwareAdobe ImageReadyq�e&lt;3�IDATx���   |����p��B�Ik�$mV$!��mR����9�]�-�v��o�����n������<br/>
<br/>
As we can clearly see that we have obfuscate the php file in the png magic bytes and were able to upload the file successfully<br/>
<img height="198" src="image 5.png" width="600"/><br/>
<br/>
We are getting error's<br/>
<img height="281" src="image 8.png" width="800"/><br/>
<img height="183" src="image 6.png" width="800"/><br/>
<br/>
let's strip some of the magic bytes out<br/>
<br/>
<img height="80" src="image 7.png" width="650"/><br/>
<br/>
<b><span style="background-color: #ff0000">So don't ever use </span><span style="background-color: #ffa300">block list</span><span style="background-color: #ff0000">to prevent file uplods.</span></b><br/>
<br/>
<br/>
<br/>
<br/>
</body></html>